\chapter{Infraestructura}\label{CAP:MatMet}

 En cada uno de los siguientes apartados se detallará la función de los programas o dispositivos necesarios para la elaboración de este proyecto.
 Debido a la naturaleza de la plataforma JdeRobot, el sistema operativo que se ha elegido para el desarrollo y ejecución de los componentes ha sido Linux. En concreto, la distribución Ubuntu 14.04.

\section{Interfaz Gráfica de usuario}
También conocida como \textit{GUI}, es el software encargado de simplificar la interacción con los usuarios. Proporciona texto, imágenes y diferentes objetos gráficos para representar la información y e interactuar con las acciones que se ofrezcan en un programa.

\subsection{Qt}
Qt\footnote{http://www.qt.io/} es una biblioteca multiplatarforma cuyo objetivo principal es el de facilitar el diseño de interfaces gráficas de usuario. Su modelo de desarrollo es el de software libre y de código abierto, bajo la licencia GPL v3 y LGPL v2.1. Está programada en C++, aunque puede ser utilizada junto a otros lenguajes de programación. Ofrece un \textit{ambiente de desarrollo integrado}(IDE en inglés) llamado QtCreator, que facilita el proceso de desarrollo y el diseño gráfico del GUI. La versión utilizada en este proyecto es la 4.8.

\begin{figure}[hbtp]
\centering
{\includegraphics[scale=0.2]{./Figuras/qt.jpg}}\hspace{10mm}
%\subfigure[Personas en Gazebo]{\includegraphics[scale=0.26]{./Figuras/gazebo2.png}}
\caption{Qt Creator}

\label{FIG:31_qtcreator}
\end{figure}

\subsubsection{PyQt}

PyQt\footnote{https://riverbankcomputing.com/software/pyqt/intro} es una colección de bibliotecas escritas en Python y C++ que complementan Qt. Mantiene la característica multiplataforma  y es un partner reconocido oficialmente por el propio Qt. Se encuentra bajo la licencia GPL v3 y la \textit{Riverbank Commercial License}. En este proyecto se ha utilizado para el desarrollo de componentes utilizando el lenguaje de programación Python. La versión utilziada en este proyecto es la PyQt5.

\subsection{Matplotlib}

Matplotlib\footnote{http://matplotlib.org/} es una librería en python para dibujar gráficas en dos dimensiones. Ofrece una interfaz muy cercana a la ofrecida por el programa \textit{Matlab} y su utilización resulta muy familiar para usuarios que dominan este programa. Su principal ventaja es la simplicación a la hora de dibujar diferentes estilos de líneas, cambiar las propiedades de ejes, las propiedades del texto, etcétera.


\section{ICE}

ICE\footnote{https://zeroc.com/} es un middleware orientado a objetos proporciona las herramientas, APIs y librerías necesarías para simplificar las comunicaciones entre cliente y servidor. En JdeRobot es la plataforma elegida como infraestructura para todos los procesos de comunicación entre componentes y plugins. Proporciona una capa transparente que se encarga de abrir y cerrar conexiones, la serialización de información, retransmisión de paquetes perdidos, etcétera. La versión utilizada en este proyecto es la 3.5

\section{JdeRobot}

En el mundo de la robótica, existen diferentes plataformas que simplifican y aportan las herramientas necesarios para el desarrollo de aplicaciones en robots. JdeRobot es una de ellas y consiste en una colección de aplicaciones robóticas, domóticas y de visión artificial. Estas aplicaciones están escritas en diferentes lenguajes como C++, Java o Python y su interoperación se realiza a través de interfaces ICE. En ella participan desarrolladores de diferentes niveles desde profesionales del sector, profesores, alumnos de la Universidad Rey Juan Carlos y de otras universidades de todo el mundo. 
Durante el ciclo de vida este proyecto ha servido como plataforma de exposición de los progresos y logros conseguidos. El código fuente es libre y está bajo la licencia GPLv3 y la documentación se encuentra protegido bajo la licencia de Creative Commons by-SA.

Durante el desarrollo de este TFG, comoponentes como uav\_viewer, introrob\_py han servido de referencia y han tenido una gran relevancia para el aprendizaje de la plataforma.
La versión utilizada en este proyecto es la 5.2.4\footnote{https://github.com/RoboticsURJC/JdeRobot}

\subsection{Teleoperadores uav\_viewer e introrob\_py}

Ambos son componentes de JdeRobot y su función es la de ofrecer una GUI para enviar comandos tanto al cuadricóptero real, como al Ardrone creado por Daniel Yagüe. 
Los comandos se envían a través de interfaces ICE. Estos permiten el desarrollo de programas independientemente del tipo de cuadricóptero(real o simulado) y transportan la información de los sensores. La principal diferencia entre ambos es el lenguaje en el que han sido desarrollados: introrob\_py está escrito en Python mientras que uav\_viewer está en C++.

\begin{figure}[hbtp]
\centering
{\includegraphics[scale=0.28]{./Figuras/ardroneplugin-connections.png}}
\caption{Interfaz de JdeRobot para el AR.Drone}

\label{FIG:32_JdeRobot}
\end{figure}

\section{Gazebo}

La herramienta en la que se realizan todas las pruebas es el entorno de simulación Gazebo. Ya fue introducido en el apartado \ref{SEC:Simulación}, por tanto, hablaremos de su estructura y las bibliotecas de las que se sirve este proyecto.

Gazebo se divide en dos programas:

\begin{enumerate}
\item \textbf{Gzclient}: Es la GUI a través la cual visualizar los resultados y comportamientos de nuestros modelos virtuales. Ofrece diferentes herramientas como la pausa de la simulación, toma de instantáneas, añadir objetos sobre la marcha, etcétera.

\item \textbf{Gzserver}: Este programa se encarga del control de la simulación, la generación del mundo virtual y el motor físico.
\end{enumerate}

La estructura que define una simulación en Gazebo se compone de varios elementos:

\begin{itemize}
\item \textbf{Mundos}: Describen todos los elementos que contiene una simulación, incluyendo robots, luces, sensores y objetos estáticos. Están escritos en formato SDF (explicado más adelante) y usan la extensión \textit{.world} .

\item \textbf{Modelos}: Se generan a partir de archivos en formato SDF. Contienen las propiedades y los plugins necesarios para la simulación. Gazebo incluye una base datos de robots que se descarga a través de Internet. Estos modelos pueden ser insertados y facilitan la familiarización con el entorno.

\item \textbf{Variables de entorno}: Se utiliza para localizar los diferentes archivos como mundos, modelos o plugins.

\item \textbf{Plugins}: Son un mecanismo para interacción con Gazebo a través de su API\footnote{http://gazebosim.org/api.html}. Permiten la modificación de parámetros durante la simulación, con el fin de cambiar el comportamiento de los modelos. 

\end{itemize}

\subsubsection{Formato SDF}
Algunos de los elementos anteriormente mencionados utilizan el formato SDF, el cual se basa en lenguaje XML para describir las propiedades de los mundos y modelos en Gazebo.
\begin{figure}[hbtp]
\centering
{\includegraphics[scale=0.55]{./Figuras/sdf.png}}
%\subfigure[Personas en Gazebo]{\includegraphics[scale=0.26]{./Figuras/gazebo2.png}}
\caption{Ejemplo del formato SDF}

\label{FIG:32_sdf}
\end{figure}

\subsection{Plugins}

Los plugins permiten acceder a todas las funcionalidades de Gazebo a través de clases en C++ descritas en la su respectiva API\footnote{http://gazebosim.org/api.html}. 

\section{Blender}

\section{Visualización virtual}

\subsection{AprilTags}

En este proyecto, se utilizará una librería basada en visualización virtual denominada \textit{AprilTags}. Es un sistema de visualización fiduciaria. Estos sistemas se basan es símbolos diseñados para ser fácilmente reconocidos del resto del entorno. Puede detectar uno o varios símbolos en la misma imagen. Además de proporcionar información como la identificación y posición del símbolo dentro de una imagen. Es un sistema robusto cuyo funcionamiento es independiente del ángulo y diferentes sistuaciones de luminosidad en la imagen.

\begin{figure}[hbtp]
\centering
{\includegraphics[scale=0.9]{./Figuras/apriltag.png}}
%\subfigure[Personas en Gazebo]{\includegraphics[scale=0.26]{./Figuras/gazebo2.png}}
\caption{Ejemplo de detección en AprilTag}

\label{FIG:33_apriltag}
\end{figure}

Sus aplicaciones son muy variadas, desde la captura de moviento en objetos hasta sistemas de balizas en técnicas de navegación. Otra de sus aplicaciones es la de \textit{realidad aumentada}, sustituyendo el símbolo por una imagen virtualizada.

Originalmente está escrita en C y Java pero Ed Olson de Massachusetts Institute of Technology(MIT) ha creado una adaptación en C++. El código\footnote{https://svn.csail.mit.edu/apriltags} es abierto y está protegido bajo la LGPLv2.1. Entre sus depencias se encuentran OpenCV y Eigen3 que son conocidas bibliotecas de tratamiento de imagen en Linux.

Los símbolos se dividen en diferentes familias. Estas familias utilizan un número de bits y de distancia de Hamming diferentes.

\begin{figure}[hbtp]
\centering
{\includegraphics[scale=0.22]{./Figuras/apriltags-codes.png}}
%\subfigure[Personas en Gazebo]{\includegraphics[scale=0.26]{./Figuras/gazebo2.png}}
\caption{Ejemplos de familias en AprilTag}

\label{FIG:34_apriltag_families}
\end{figure}


\subsection{OpenCV}

\section{Dispositivos físicos}

\subsection{MK802IV}

\subsection{Ar.Drone 2}


